// ---------------- Generator & DB ----------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


// ---------------- Enums ----------------

enum BookingStatus {
  pending
  confirmed
  cancelled
}

enum Gender {
  M
  F
  Other
}

enum PackageType {
  PRIVATE
  JOIN
}

enum PackageCategory {
  FULL_TALU
  SHORT_TALU
  FULL_REMOTE
  JOIN_GROUP
}

enum PackageStatus {
  active
  inactive
}

enum JoinTripStatus {
  draft
  open
  closed
  cancelled
}


// ---------------- Models ----------------

// ----------- USER ----------------

model User {
  user_id      Int    @id @default(autoincrement())
  username     String  @db.VarChar(30)
  user_fname   String  @db.VarChar(30)
  user_lname   String  @db.VarChar(30)
  email        String  @unique @db.VarChar(50)
  role         String  @db.Char(1)
  password     String  @db.VarChar(100)
  phone_number String  @db.Char(10)

  bookings     Booking[]
}



// ----------- BOAT ----------------

model Boat {
  boat_id               Int        @id @default(autoincrement())
  name                  String     @db.VarChar(80)
  code                  String?    @db.VarChar(30)
  type                  String     @db.VarChar(30)
  capacity              Int
  extra_private_price   Decimal    @default(0) @db.Decimal(10, 2)
  is_active             Boolean    @default(true)

  // relations
  bookings              Booking[]
  joinTrips             JoinTrip[]
  packages              Package[]

  created_at            DateTime   @default(now())
  updated_at            DateTime   @default(now()) @updatedAt
}



// ----------- PACKAGE ----------------

model Package {
  package_id             Int               @id @default(autoincrement())
  name                   String            @db.VarChar(120)
  description            String?           @db.Text
  price                  Decimal           @db.Decimal(10, 2)
  package_pic            String?           @db.VarChar(255)

  type                   PackageType       @default(PRIVATE)
  category               PackageCategory
  status                 PackageStatus     @default(active)

  // optional main boat
  boat_id                Int?
  boat                   Boat?             @relation(fields: [boat_id], references: [boat_id])

  // trip info
  main_location          String?           @db.VarChar(120)
  spot_count             Int?
  duration_minutes       Int?
  max_participants       Int?

  // pricing
  base_member_count      Int               @default(1)
  extra_price_per_person Decimal?          @db.Decimal(10, 2)

  // details text
  includes_left          String?           @db.Text
  includes_right         String?           @db.Text

  created_at             DateTime          @default(now())
  updated_at             DateTime          @default(now()) @updatedAt

  bookings               Booking[]
  joinTrips              JoinTrip[]
}



// ----------- JOIN TRIP (for JOIN packages) ----------------

model JoinTrip {
  join_trip_id      Int              @id @default(autoincrement())
  package_id        Int
  boat_id           Int
  trip_date         DateTime
  time_slot         String           @db.VarChar(50)
  price_per_person  Decimal          @db.Decimal(10, 2)
  max_seats         Int
  status            JoinTripStatus   @default(open)

  package           Package          @relation(fields: [package_id], references: [package_id])
  boat              Boat             @relation(fields: [boat_id], references: [boat_id])
  bookings          Booking[]

  created_at        DateTime         @default(now())
  updated_at        DateTime         @default(now()) @updatedAt

  @@map("join_trip")
}



// ----------- BOOKING (Private + Join) ----------------

model Booking {
  booking_id    Int            @id @default(autoincrement())
  user_id       Int
  package_id    Int

  // สำหรับ Join Group -> อ้างรอบ
  join_trip_id  Int?

  // สำหรับ Private Trip -> อ้างเรือโดยตรง
  boat_id       Int?

  trip_date     DateTime
  time_slot     String         @db.VarChar(50)
  people        Int
  total_price   Decimal        @db.Decimal(10, 2)
  status        BookingStatus  @default(pending)

  created_at    DateTime       @default(now())
  updated_at    DateTime       @default(now()) @updatedAt

  // relations
  user          User           @relation(fields: [user_id], references: [user_id])
  package       Package        @relation(fields: [package_id], references: [package_id])
  joinTrip      JoinTrip?      @relation(fields: [join_trip_id], references: [join_trip_id])
  boat          Boat?          @relation(fields: [boat_id], references: [boat_id])
  passengers    Passenger[]

  @@map("booking")
}



// ----------- PASSENGER ----------------

model Passenger {
  passenger_id  Int       @id @default(autoincrement())
  booking_id    Int

  fname         String
  lname         String
  age           Int
  gender        Gender

  created_at    DateTime @default(now())
  updated_at    DateTime @default(now()) @updatedAt

  booking       Booking   @relation(fields: [booking_id], references: [booking_id], onDelete: Cascade)

  @@map("passenger")
}